{% comment %}
  Renders a swatch for facet filter values, with fallback color generation
  Similar to swatch.liquid but generates colors from value names when swatch data is missing

  Accepts:
  - swatch: {Object} a swatch object (optional)
  - value: {String} the filter value name (required if swatch is missing)
  - shape: {String} swatch shape. Accepts 'square', defaults to circle.

  Usage:
  {% render 'facet-swatch',
    swatch: value.swatch,
    value: value.value,
    shape: 'square'
  %}
{% endcomment %}

{%- liquid
  assign swatch_value = null
  assign swatch_focal_point = null
  assign has_multiple_colors = false
  assign gradient_colors = ''
  assign fallback_color_2 = ''

  # First, try to use provided swatch data
  if swatch.image
    assign image_url = swatch.image | image_url: width: 50
    assign swatch_value = 'url(' | append: image_url | append: ')'
    assign swatch_focal_point = swatch.image.presentation.focal_point
  elsif swatch.color
    assign swatch_value = 'rgb(' | append: swatch.color.rgb | append: ')'
  elsif value
    # Fallback: Generate color from value name
    assign value_name_clean = value | downcase | strip
    assign fallback_color = '#cccccc'

    # Handle multi-color values like "Red / Black"
    if value_name_clean contains ' / '
      assign color_parts = value_name_clean | split: ' / '
      assign primary_color_name = color_parts[0] | strip
      if color_parts[1]
        assign secondary_color_name = color_parts[1] | strip
        assign has_multiple_colors = true
      endif
    elsif value_name_clean contains '/'
      assign color_parts = value_name_clean | split: '/'
      assign primary_color_name = color_parts[0] | strip
      if color_parts[1]
        assign secondary_color_name = color_parts[1] | strip
        assign has_multiple_colors = true
      endif
    else
      assign primary_color_name = value_name_clean
    endif

    # Map color names to hex values
    case primary_color_name
      when 'red'
        assign fallback_color = '#ff0000'
      when 'blue'
        assign fallback_color = '#0000ff'
      when 'green'
        assign fallback_color = '#008000'
      when 'yellow'
        assign fallback_color = '#ffff00'
      when 'orange'
        assign fallback_color = '#ffa500'
      when 'purple'
        assign fallback_color = '#800080'
      when 'pink'
        assign fallback_color = '#ffc0cb'
      when 'black'
        assign fallback_color = '#000000'
      when 'white'
        assign fallback_color = '#ffffff'
      when 'grey', 'gray'
        assign fallback_color = '#808080'
      when 'brown'
        assign fallback_color = '#a52a2a'
      when 'navy'
        assign fallback_color = '#000080'
      when 'tan', 'beige'
        assign fallback_color = '#f5f5dc'
      when 'olive'
        assign fallback_color = '#808000'
      when 'gold'
        assign fallback_color = '#d4af37'
      when 'silver'
        assign fallback_color = '#c0c0c0'
      else
        # Try to extract color from name
        if value_name_clean contains 'red'
          assign fallback_color = '#ff0000'
        elsif value_name_clean contains 'blue'
          assign fallback_color = '#0000ff'
        elsif value_name_clean contains 'green'
          assign fallback_color = '#008000'
        elsif value_name_clean contains 'yellow'
          assign fallback_color = '#ffff00'
        elsif value_name_clean contains 'orange'
          assign fallback_color = '#ffa500'
        elsif value_name_clean contains 'purple'
          assign fallback_color = '#800080'
        elsif value_name_clean contains 'pink'
          assign fallback_color = '#ffc0cb'
        elsif value_name_clean contains 'black'
          assign fallback_color = '#000000'
        elsif value_name_clean contains 'white'
          assign fallback_color = '#ffffff'
        elsif value_name_clean contains 'brown'
          assign fallback_color = '#a52a2a'
        elsif value_name_clean contains 'grey' or value_name_clean contains 'gray'
          assign fallback_color = '#808080'
        elsif value_name_clean contains 'gold'
          assign fallback_color = '#d4af37'
        else
          assign fallback_color = '#cccccc'
        endif
    endcase

    # Map secondary color if multi-color
    if has_multiple_colors and secondary_color_name
      case secondary_color_name
        when 'red'
          assign fallback_color_2 = '#ff0000'
        when 'blue'
          assign fallback_color_2 = '#0000ff'
        when 'green'
          assign fallback_color_2 = '#008000'
        when 'yellow'
          assign fallback_color_2 = '#ffff00'
        when 'orange'
          assign fallback_color_2 = '#ffa500'
        when 'purple'
          assign fallback_color_2 = '#800080'
        when 'pink'
          assign fallback_color_2 = '#ffc0cb'
        when 'black'
          assign fallback_color_2 = '#000000'
        when 'white'
          assign fallback_color_2 = '#ffffff'
        when 'grey', 'gray'
          assign fallback_color_2 = '#808080'
        when 'brown'
          assign fallback_color_2 = '#a52a2a'
        when 'navy'
          assign fallback_color_2 = '#000080'
        when 'tan', 'beige'
          assign fallback_color_2 = '#f5f5dc'
        when 'olive'
          assign fallback_color_2 = '#808000'
        when 'gold'
          assign fallback_color_2 = '#d4af37'
        when 'silver'
          assign fallback_color_2 = '#c0c0c0'
        else
          assign fallback_color_2 = '#000000'
      endcase
    endif

    # Set swatch value
    assign swatch_value = fallback_color
  endif
-%}

<span
  {% if swatch_value %}
    class="swatch{% if shape == 'square' %} swatch--square{% endif %}"
    style="--swatch--background: {{ swatch_value }};{% if swatch_focal_point %} --swatch-focal-point: {{ swatch_focal_point }};{% endif %}{% if has_multiple_colors and fallback_color_2 != '' %} background: linear-gradient(135deg, {{ fallback_color }} 0%, {{ fallback_color }} 50%, {{ fallback_color_2 }} 50%, {{ fallback_color_2 }} 100%);{% endif %}"
  {% else %}
    class="swatch swatch--unavailable{% if shape == 'square' %} swatch--square{% endif %}"
  {% endif %}
></span>
